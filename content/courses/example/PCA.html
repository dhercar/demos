---
title: PCA and beautiful biplot
type: book
highlight: true
author: "Daniel Hern√°ndez"
date: 2
categories: ["PCA"]
tags: ["PCA", "plot"]
---



<!--more-->
<p>In this tutorial you will learn how to use the <code>prcomp</code> function to perform a principal component analyses (PCA) and display the results in a fully customizable format. I assume you are familiarized with the theory behind a PCA and have basic R-programming skills.</p>
<p>We are going to use the <a href="https://archive.ics.uci.edu/ml/datasets/iris">iris</a> dataset as an example. It includes four numerical variables representing four flower characteristics and one categorical variable that corresponds to the taxonomic classification.</p>
<pre class="r"><code>data(iris) # Load dataset
sapply(iris, class) #Check the class of variables</code></pre>
<pre><code>## Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species 
##    &quot;numeric&quot;    &quot;numeric&quot;    &quot;numeric&quot;    &quot;numeric&quot;     &quot;factor&quot;</code></pre>
<div id="preparing-the-data" class="section level2">
<h2>Preparing the data</h2>
<p>A good way to inspect the data is to analyse the correlation between variables. For that I like using the <code>PerformanceAnalytics</code> package.</p>
<pre class="r"><code>PerformanceAnalytics:: chart.Correlation(iris[,-5],
                                         histogram=TRUE, 
                                         pch=10,
                                         method = &quot;pearson&quot;)</code></pre>
<p><img src="/courses/example/PCA_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>There are strong correlations between some variables, specially between <code>Petal.Length</code> and <code>Petal.Width</code>. For this example we are going to keep both variables, but you could consider removing one when such strong correlations are detected.</p>
<p>Next, we can visually explore the distribution of the variables.</p>
<pre class="r"><code>library(ggplot2)

iris.num &lt;- iris[,-5] #variables to use in the PCA


ggplot(stack(data.frame(scale(iris.num))), aes(x=ind, y=values)) +
  geom_boxplot(width=0.5) +  #draw boxplot
  geom_jitter(width=0.1, alpha=0.5) #draw points </code></pre>
<p><img src="/courses/example/PCA_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>The distribution seem symmetric enough. Otherwise, a proper transformation variables would be needed.</p>
</div>
<div id="pca" class="section level2">
<h2>PCA</h2>
<p>We can use the <code>vegan</code> package to perfoorm a PCA using the <code>rda()</code>function.</p>
<pre class="r"><code>library(vegan)</code></pre>
<pre><code>## Loading required package: permute</code></pre>
<pre><code>## Loading required package: lattice</code></pre>
<pre><code>## This is vegan 2.5-7</code></pre>
<pre class="r"><code>pca.out &lt;- rda(iris.num, scale=TRUE)
pca.out$inertia</code></pre>
<pre><code>## [1] &quot;correlations&quot;</code></pre>
<p>The result of the PCA has been stored with the name of <code>pca.out</code>. One important aspect of a PCA is the % of variance explained by each principal component, which can be consulted in the <code>$CA$eig</code> section of the PCA output.</p>
<pre class="r"><code>kableExtra::kable(round(data.frame(summary(pca.out)[6]), 3))</code></pre>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
cont.importance.PC1
</th>
<th style="text-align:right;">
cont.importance.PC2
</th>
<th style="text-align:right;">
cont.importance.PC3
</th>
<th style="text-align:right;">
cont.importance.PC4
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Eigenvalue
</td>
<td style="text-align:right;">
2.918
</td>
<td style="text-align:right;">
0.914
</td>
<td style="text-align:right;">
0.147
</td>
<td style="text-align:right;">
0.021
</td>
</tr>
<tr>
<td style="text-align:left;">
Proportion Explained
</td>
<td style="text-align:right;">
0.730
</td>
<td style="text-align:right;">
0.229
</td>
<td style="text-align:right;">
0.037
</td>
<td style="text-align:right;">
0.005
</td>
</tr>
<tr>
<td style="text-align:left;">
Cumulative Proportion
</td>
<td style="text-align:right;">
0.730
</td>
<td style="text-align:right;">
0.958
</td>
<td style="text-align:right;">
0.995
</td>
<td style="text-align:right;">
1.000
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>varExp &lt;- pca.out$CA$eig/sum(pca.out$CA$eig)*100 </code></pre>
<pre class="r"><code>ggplot(data.frame(varExp,
                  PC= substr(names(varExp), 3,5)), 
       aes(x=as.numeric(PC), y=varExp))+
    geom_line(col=&quot;grey40&quot;, size=0.7)+
  geom_point(colour=&quot;coral3&quot;, size=3) + 
  theme(aspect.ratio=0.5)+
  xlab(&quot;PC&quot;)+
  ylab(&quot;Proportion explained (%)&quot;)</code></pre>
<p><img src="/courses/example/PCA_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>The first PC axis summarizes a big part of the variance (75%) and adding a second PC allows for includding more than 90% of the variance.</p>
</div>
